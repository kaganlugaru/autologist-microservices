"""
–¢–µ—Å—Ç –ø–∞—Ä—Å–µ—Ä–∞ - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
"""

import asyncio
import os
from datetime import datetime

# –ò–º–∏—Ç–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
test_message_data = {
    'message_text': '–°—Ä–æ—á–Ω–æ –Ω—É–∂–µ–Ω –≥—Ä—É–∑ 17–º –∏–∑ –ê–ª–º–∞—Ç—ã –≤ –ê—Å—Ç–∞–Ω—É',
    'chat_name': '–¢–µ—Å—Ç–æ–≤—ã–π —á–∞—Ç –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–æ–∫',
    'chat_id': '-1001234567890',
    'user_id': '123456789',
    'message_id': '999',
    'sender_info': {
        'display_name': '–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
        'username': 'testuser',
        'profile_link': 'https://t.me/testuser'
    }
}

test_keywords_found = ['17–º', '–≥—Ä—É–∑']

def test_recipients_logic():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π"""
    
    # –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –∏–∑ –±–∞–∑—ã
    test_recipients = [
        {
            'id': 1,
            'name': '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
            'phone': '+77771234567',
            'username': None,
            'category': '–≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∏'
        },
        {
            'id': 2,
            'name': '–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤',
            'phone': None,
            'username': 'petrov_cargo',
            'category': '–≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∏'
        },
        {
            'id': 3,
            'name': '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞',
            'phone': '+77779876543',
            'username': 'maria_cargo',
            'category': '–≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∏'
        }
    ]
    
    print("üß™ –¢–ï–°–¢: –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏")
    print("=" * 50)
    
    for recipient in test_recipients:
        contact_info = None
        contact_type = None
        
        # –õ–æ–≥–∏–∫–∞ –∏–∑ –ø–∞—Ä—Å–µ—Ä–∞
        if recipient.get('phone'):
            contact_info = recipient['phone']
            contact_type = 'phone'
        elif recipient.get('username'):
            contact_info = recipient['username']
            contact_type = 'username'
        else:
            print(f"‚ùå {recipient['name']}: –ù–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö")
            continue
        
        if contact_type == 'phone':
            print(f"‚úÖ {recipient['name']}: –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É {contact_info}")
        else:
            print(f"‚úÖ {recipient['name']}: –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ username @{contact_info}")
    
    print("\nüéØ –†–ï–ó–£–õ–¨–¢–ê–¢: –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    print("- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚Üí username")
    print("- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –±–µ–∑ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤")

def test_notification_format():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"""
    
    print("\nüìù –¢–ï–°–¢: –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è")
    print("=" * 50)
    
    notification_text = f"""üîî **–ù–û–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï –ü–û –ö–õ–Æ–ß–ï–í–´–ú –°–õ–û–í–ê–ú**

**–ß–∞—Ç:** {test_message_data['chat_name']}
**–û—Ç:** [{test_message_data['sender_info']['display_name']}]({test_message_data['sender_info']['profile_link']})
**–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:** {', '.join(test_keywords_found)}

**–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
{test_message_data['message_text']}
```

---
‚è∞ **–í—Ä–µ–º—è:** {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}"""
    
    print("üìÑ –ü—Ä–∏–º–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:")
    print(notification_text)
    
    print("\n‚úÖ –§–æ—Ä–º–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:")
    print("- –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞")
    print("- –ö–ª–∏–∫–∞–±–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è")
    print("- –°–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤")
    print("- –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è")
    print("- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")

def test_database_structure():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î"""
    
    print("\nüóÑÔ∏è –¢–ï–°–¢: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö")
    print("=" * 50)
    
    print("üìã –ó–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π:")
    print("1. keywords -> category (–ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É)")
    print("2. recipient_categories -> recipients (–ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)")
    
    print("\nüìã –ü–æ–ª—è —Ç–∞–±–ª–∏—Ü—ã recipient_categories:")
    print("- id: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä")
    print("- name: –∏–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è")
    print("- phone: –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (+77771234567) - –ù–û–í–û–ï –ü–û–õ–ï")
    print("- username: username Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)")
    print("- category: –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∏, –ª–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ —Ç.–¥.)")
    print("- active: –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—è")
    
    print("\n‚ö†Ô∏è –í–ê–ñ–ù–û: –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è phone –≤ Supabase")
    print("–ü–∞—Ä—Å–µ—Ä —Å–º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –Ω–æ–º–µ—Ä–∞–º —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤")

if __name__ == "__main__":
    print("üöÄ –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í –ü–ê–†–°–ï–†–ê")
    print("=" * 60)
    
    test_recipients_logic()
    test_notification_format()
    test_database_structure()
    
    print("\n" + "=" * 60)
    print("‚úÖ –í–°–ï –¢–ï–°–¢–´ –ó–ê–í–ï–†–®–ï–ù–´")
    print("\nüìå –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:")
    print("1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ 'phone' –≤ —Ç–∞–±–ª–∏—Ü—É recipient_categories –≤ Supabase")
    print("2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π —Å –Ω–æ–º–µ—Ä–∞–º–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å")
    print("3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø–∞—Ä—Å–µ—Ä–∞ –≤ Railway")